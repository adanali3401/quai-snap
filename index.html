<!DOCTYPE html>
<html>
  <head>
    <title>Hello, Snaps!</title>
    <link rel="icon" type="image/svg" href="./images/icon.svg" />
  </head>

  <body>
    <h1>Welcome to QuaiSnap!</h1>
    <a
      href="https://docs.quai.network/use-quai/wallets/quaisnap"
      target="_blank"
    >
      Docs
    </a>
    <details>
      <summary>Instructions</summary>
      <ul>
        <li>First, click "Connect". Then, try out the other buttons!</li>
        <li>Please note that:</li>
        <ul>
          <li>
            The <code>snap.manifest.json</code> and
            <code>package.json</code> must be located in the server root
            directory..
          </li>
          <li>
            The Snap bundle must be hosted at the location specified by the
            <code>location</code> field of <code>snap.manifest.json</code>.
          </li>
        </ul>
      </ul>
      <br />
    </details>
    <br />

    <button class="connect">Connect</button>
    <br />
    <br />
    <button class="genAllAccounts">Generate All Accounts</button>
    <br />
    <br />
    <button class="getaccounts">GetAccounts</button>
    <br />
    <br />
    <button class="getCurrentAccount">Get Current Account</button>

    <br />
    <br />
    <input id="privateKeyAddress" placeholder="0x...." type="text" />
    <button class="getPrivKey">Get Private Key For Address</button>
    <br />
    <br />
    <input id="balanceAddress" placeholder="0x...." type="text" />
    <button class="getBalance">Get Balance</button>
    <br />
    <br />
    <input
      id="SendTo"
      value="0xD5813D46F74273048D485944DC7DE12FC1947f12"
      placeholder="reciver address"
    />
    <input id="Amount" value="100000" placeholder="amount" type="number" />
    <button class="send">Send</button>
    <br />
    <br />
    <input id="setAddress" value="0x....." type="text" />
    <button class="setCurrentAccount" value="Cyprus">
      Set Current Account
    </button>
    <br />
    <br />
    <button class="clearAccounts">Clear Accounts</button>
    <br />
    <br />
    <input id="accountName" placeholder="Account Name" type="text" />
    <button class="createAccount">Create Account</button>
    <br />
    <br />
    <input id="createByChain" value="cyprus-1" type="'text" />
    <button class="createQuaiAccountByChain">Create Account by Chain</button>
    <br />
    <br />
    <button class="blockHeight">Block Height</button>

    <br />
    <br />

    <input id="NumAccounts" value="25" placeholder="amount" type="number" />
    <button class="generateNum">Generate N Accounts</button>
  </body>
  <script>
    const snapId = `local:${location.href}`;
    const connectButton = document.querySelector('button.connect');
    const genAllAccountsButton = document.querySelector(
      'button.genAllAccounts',
    );
    const getCurrentAccountButton = document.querySelector(
      'button.getCurrentAccount',
    );
    const setCurrentAccountButton = document.querySelector(
      'button.setCurrentAccount',
    );
    const createAccountButton = document.querySelector('button.createAccount');
    const accountByChainButton = document.querySelector(
      'button.createQuaiAccountByChain',
    );
    const getAccountsButton = document.querySelector('button.getaccounts');
    const generateNButton = document.querySelector('button.generateNum');
    const clearButton = document.querySelector('button.clearAccounts');
    const privKeyByAddressButton = document.querySelector('button.getPrivKey');
    const getBalanceButton = document.querySelector('button.getBalance');
    const blockHeightButton = document.querySelector('button.blockHeight');

    const sendButton = document.querySelector('button.send');
    sendButton.addEventListener('click', sendTransaction);
    connectButton.addEventListener('click', connect);
    getAccountsButton.addEventListener('click', getAccounts);
    createAccountButton.addEventListener('click', createAccount);
    getBalanceButton.addEventListener('click', getBalance);
    clearButton.addEventListener('click', clearAccounts);
    blockHeightButton.addEventListener('click', blockHeight);
    generateNButton.addEventListener('click', generateNumAccounts);
    privKeyByAddressButton.addEventListener('click', getPrivKeyByAddress);
    getCurrentAccountButton.addEventListener('click', getCurrentAccount);
    setCurrentAccountButton.addEventListener('click', setCurrentAccount);
    genAllAccountsButton.addEventListener('click', genAllAccounts);
    accountByChainButton.addEventListener('click', createQuaiAccountByChain);

    async function connect() {
      await ethereum.request({
        method: 'wallet_requestSnaps',
        params: {
          [snapId]: {},
        },
      });
    }

    async function genAllAccounts() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: { method: 'generateAllAccounts' },
          },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function getCurrentAccount() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: { snapId: snapId, request: { method: 'getCurrentAccount' } },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function setCurrentAccount() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: {
              method: 'setCurrentAccount',
              params: {
                address: document.querySelector('#setAddress').value,
              },
            },
          },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function getAccounts() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: { snapId: snapId, request: { method: 'getAccounts' } },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function createAccount() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: {
              method: 'createAccountByName',
              params: {
                name: document.querySelector('#accountName').value,
              },
            },
          },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function createQuaiAccountByChain() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: {
              method: 'createAccountByChain',
              params: {
                name: document.querySelector('#accountName').value,
                chain: document.getElementById('createByChain').value,
              },
            },
          },
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function generateNumAccounts() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: {
              method: 'generateNumAccounts',
              params: {
                amount: document.querySelector('#NumAccounts').value,
              },
            },
          },
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function clearAccounts() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: { snapId: snapId, request: { method: 'clearAccounts' } },
        });
        console.log(response);
        alert(JSON.stringify(response));
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function getPrivKeyByAddress() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: {
            snapId: snapId,
            request: {
              method: 'getPrivateKeyByAddress',
              params: {
                address: document.querySelector('#privateKeyAddress').value,
              },
            },
          },
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function getBalance() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'getBalance',
              params: {
                testnet: true,
                address: document.querySelector('#balanceAddress').value,
              },
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function displayBalance() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'displayBalance',
              params: {
                address: document.querySelector('#balanceAddress').value,
              },
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    // here we call the snap's "hello" method
    async function blockHeight() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'getBlockHeight',
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function sign() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'signData',
              params: {
                data: document.querySelector('#SignMessage').value,
              },
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    //Getting user transactions
    async function getTransactions() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'getTransactions',
              params: {
                testnet: true,
              },
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function sendTransaction() {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId,
            {
              method: 'sendTransaction',
              params: {
                to: '0x146F08a82299B7958a25a77A5cb6FD2Aec7c355D',
                value: 100000,

                testnet: true,
              },
            },
          ],
        });
        alert(response);
        console.log(response);
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }
  </script>
</html>
